{% extends "layout.html" %}
{% block title %}Nhật ký Hoạt động{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3><i class="fa-solid fa-clipboard-list"></i> Nhật ký Hoạt động Hệ thống</h3>
        <a href="{{ url_for('admin_manage') }}" class="btn btn-secondary">
            <i class="fa-solid fa-arrow-left"></i> Quay lại Quản lý
        </a>
    </div>

    <div class="card bg-dark border-secondary">
        <div class="card-body">
            <div class="table-responsive" style="max-height: 75vh;">
                <table class="table table-dark table-hover align-middle">
                    <thead class="sticky-top">
                        <tr>
                            <th>Thời gian</th>
                            <th>Người thực hiện (Actor)</th>
                            <th>Hành động</th>
                            <th>Chi tiết / Đối tượng</th>
                            <th>Địa chỉ IP</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for log in logs %}
                        <tr>
                            <td class="text-muted"><small>{{ log.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</small></td>
                            <td><strong>{{ log.username }}</strong></td>
                            
                            {% set parts = log.action.split(':', 1) %}
                            {% set action_type = parts[0].strip() %}
                            {% set details = parts[1].strip() if parts|length > 1 else '' %}

                            <td>
                                {% if 'login' in action_type|lower %}
                                    <span class="badge text-bg-success"><i class="fa-solid fa-right-to-bracket me-1"></i> Login</span>
                                {% elif 'logout' in action_type|lower %}
                                    <span class="badge text-bg-secondary"><i class="fa-solid fa-right-from-bracket me-1"></i> Logout</span>
                                {% elif 'blocked' in action_type|lower %}
                                    <span class="badge text-bg-warning"><i class="fa-solid fa-user-lock me-1"></i> Block User</span>
                                {% elif 'approved' in action_type|lower %}
                                    <span class="badge text-bg-info"><i class="fa-solid fa-user-check me-1"></i> Approve User</span>
                                {% elif 'unblocked' in action_type|lower %}
                                    <span class="badge text-bg-success"><i class="fa-solid fa-lock-open me-1"></i> Unblock User</span>
                                {% elif 'delete' in action_type|lower %}
                                    <span class="badge text-bg-danger"><i class="fa-solid fa-trash me-1"></i> Delete Item</span>
                                {% elif 'create folder' in action_type|lower %}
                                    <span class="badge text-bg-primary"><i class="fa-solid fa-folder-plus me-1"></i> Create Folder</span>
                                {% elif 'save file' in action_type|lower %}
                                    <span class="badge text-bg-primary"><i class="fa-solid fa-save me-1"></i> Save File</span>
                                {% elif 'open file' in action_type|lower %}
                                    <span class="badge" style="background-color: #6c757d;"><i class="fa-solid fa-file-lines me-1"></i> Open File</span>
                                {% elif 'rename' in action_type|lower %}
                                    <span class="badge text-bg-info"><i class="fa-solid fa-i-cursor me-1"></i> Rename Item</span>
                                {% elif 'upload' in action_type|lower %}
                                    <span class="badge text-bg-primary"><i class="fa-solid fa-upload me-1"></i> Upload File</span>
                                {% else %}
                                    <span class="badge text-bg-dark">{{ action_type }}</span>
                                {% endif %}
                            </td>
                            <td>
                                <small class="text-muted" style="word-break: break-all;">{{ details }}</small>
                            </td>
                            <td class="text-muted"><small>{{ log.ip_address }}</small></td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" class="text-center text-muted p-5">
                                <i class="fa-solid fa-inbox fa-2x mb-2"></i><br>
                                Chưa có hoạt động nào được ghi lại.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
